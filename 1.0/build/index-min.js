/*!build time : 2014-04-28 8:31:32 PM*/
KISSY.add("gallery/number-range/1.0/index",function(a,b,c,d){function e(){this._init.apply(this,arguments)}var f=b.all,g={tipType:"force",fixed:null,cls:"",tpl:"{tipText}",offset:[0,0],points:["cr","cl"],min:0,max:1e10,minTipText:"\u53ef\u8f93\u5165\u7684\u6700\u5c0f\u6570\u91cf\u4e3a{value}",maxTipText:"\u53ef\u8f93\u5165\u7684\u6700\u5927\u6570\u91cf\u4e3a{value}",success:null,error:null};return a.augment(e,a.EventTarget,{_init:function(b){this.cfg=a.merge(g,b)},_isNumber:function(a){return/^\d+(\.\d*)?$/g.test(a)},_removeNotNumber:function(a,b){if(b){var c=b.replace(/[^\d.]/g,""),d=c.split(".");d.length>2&&(c=d.shift()+"."+d.join("")),a.val(c)}},_fixedNumber:function(a,b){var c=void 0!=a[0].fixed?a[0].fixed:this.cfg.fixed,d=b.indexOf(".");if("number"==typeof c&&-1!=d&&(0==c||b.split(".")[1].length>c)){var e=0==c?d:d+c+1;b=b.substring(0,e),a.val(b)}return b},_forceFillin:function(a,b){b&&b.value&&a.val(b.value)},_showTip:function(b,c){var d=this,e=c.type+"TipText",f=a.substitute(b[0][e]||this.cfg[e],c),g=a.substitute(b[0].tpl||this.cfg.tpl,{tipText:f}),h=this.getLayer();h.set("content",g),h.set("align",{points:b[0].points||d.cfg.points,offset:b[0].offset||d.cfg.offset,node:b}),h.show()},_hidePopup:function(){this.getLayer().hide()},_checkNumber:function(a,b){var c,d=this._toNumber(a.attr("data-min"))||this._toNumber(a[0].min)||this.cfg.min,e=this._toNumber(a.attr("data-max"))||this._toNumber(a[0].max)||this.cfg.max,b=this._fixedNumber(a,b);if(d>b?c={type:"min",value:d}:b>e&&(c={type:"max",value:e}),c){var f=a[0].error||this.cfg.error;if(f)f(a,c);else{var g=a[0].tipType||this.cfg.tipType,h="force"==g?"_forceFillin":"_showTip";this[h](a,c)}}else{var i=a[0].success||this.cfg.success;i?i(a):this._hidePopup()}},_checkEL:function(b){var c=a.trim(b.val());this._isNumber(c)?this._checkNumber(b,c):(this._removeNotNumber(b,c),this._hidePopup())},_setEL:function(b,c,d){if(b){var e=a.merge(this.cfg,c||{}),g="string"==typeof b?f(b):b;return g.each(function(b){a.each(e,function(a,c){b[0][c]=a}),d&&d(b)}),g}},_toNumber:function(a){return 1*a},verify:function(a,b){var c=this;this._setEL(a,b,function(a){c._checkEL(a)})},bind:function(a,b){var c=this;this._setEL(a,b,function(a){a.on("valuechange",function(){c._checkEL(a)}),a.on("blur",function(){c._hidePopup()})})},getRange:function(b,c){var d=a.merge(this.cfg,c),e=this._toNumber(b.attr("data-min"))||d.min,f=this._toNumber(b.attr("data-max"))||d.max;return{max:f,min:e}},getLayer:function(){var a=this,b=this._layer;return b||(b=this._layer=new d.Popup({elCls:a.cfg.cls}),b.render()),b}}),e},{requires:["node","event","overlay"]});